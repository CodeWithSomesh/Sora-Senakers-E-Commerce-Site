###############################################################################
# SECURITY ANALYTICS TEST CASES - FIXED VERSION
# Use VS Code REST Client Extension to run these tests
# Click "Send Request" above each test to execute
###############################################################################

### Variables (Update these as needed)
@baseUrl = http://localhost:7000
@token = eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Im1nRzB6cDJsRk5oRXNFTGxHNHpwcSJ9.eyJpc3MiOiJodHRwczovL2Rldi1rbHBsOGo3aGdwY25vYXh0LnVzLmF1dGgwLmNvbS8iLCJzdWIiOiJnb29nbGUtb2F1dGgyfDExNTc4NDUwMTIxODgwODk0MTQwNyIsImF1ZCI6WyJzbmVha2Vycy13ZWJzaXRlLWFwaSIsImh0dHBzOi8vZGV2LWtscGw4ajdoZ3Bjbm9heHQudXMuYXV0aDAuY29tL3VzZXJpbmZvIl0sImlhdCI6MTc2MzYyMDY5MywiZXhwIjoxNzYzNzA3MDkzLCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIG9mZmxpbmVfYWNjZXNzIiwiYXpwIjoiUzJiZm5DZ2F2ZWJna0pqNmdvUjJiYlBqSEFnM0VEaFoifQ.tuLBAhWo6fKObBbJFNizbNFTcI7nqrJu2CBtGaKrZM_cB1GitK5v7GqUYF5hphnxniEPaWW5hmRgy6f5JRq-iuTpM2crq55k-KZE-UosPdlNX_Yfp8HLZ6fR8FY3HDXRix-4MuESrMy7F8Y-L8AfCIfXrm2-7H9gUbBSJxgEeT2iq9uZmMjos6khaSXfNeKu_hoWfbWgYTTFWKM_MoQkktPYbe-SnP4zDPdyYkbMzbPdPLRmbBs6HBKduPCsW024rw9o7Hm6j84znNtWPq6zaKWLkjPf36IzpnGcTVueAEaq7OlwyDAwHND2YHsGs-QLpUsdj9qDdfWAdF_-kb27Sg

###############################################################################
# TEST 1: FAILED LOGIN ATTEMPTS (Brute Force Detection)
###############################################################################

### Test 1.1: First Failed Login Attempt
# Expected: attemptCount: 1, flagged: false
POST {{baseUrl}}/api/security/failed-login
Content-Type: application/json

{
  "username": "testuser@example.com",
  "email": "testuser@example.com",
  "reason": "invalid_credentials"
}

### Test 1.2: Second Failed Login Attempt
# Expected: attemptCount: 2, flagged: false
POST {{baseUrl}}/api/security/failed-login
Content-Type: application/json

{
  "username": "testuser@example.com",
  "email": "testuser@example.com",
  "reason": "invalid_credentials"
}

### Test 1.3: Third Failed Login Attempt (TRIGGERS BLOCKING)
# Expected: attemptCount: 3, flagged: true, accountBlocked: true
POST {{baseUrl}}/api/security/failed-login
Content-Type: application/json

{
  "username": "testuser@example.com",
  "email": "testuser@example.com",
  "reason": "invalid_credentials"
}

###############################################################################
# TEST 2: ADMIN ACTIONS (Requires Authentication) ✅ FIXED
# Changed: adminId to valid ObjectId, actionType to correct enum values
###############################################################################

### Test 2.1: Track Product Deletion ✅ FIXED
POST {{baseUrl}}/api/security/admin-action
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "adminId": "000000000000000000000001",
  "adminUsername": "admin@sorasneakers.com",
  "actionType": "product_deleted",
  "targetType": "product",
  "targetId": "prod_12345",
  "targetName": "Nike Air Max 2024"
}

### Test 2.2: Track Product Edit ✅ FIXED
POST {{baseUrl}}/api/security/admin-action
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "adminId": "000000000000000000000001",
  "adminUsername": "admin@sorasneakers.com",
  "actionType": "product_edited",
  "targetType": "product",
  "targetId": "prod_67890",
  "targetName": "Adidas UltraBoost",
  "changes": {
    "price": {
      "old": 150,
      "new": 120
    }
  }
}

### Test 2.3: Track Product Addition ✅ FIXED
POST {{baseUrl}}/api/security/admin-action
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "adminId": "000000000000000000000001",
  "adminUsername": "admin@sorasneakers.com",
  "actionType": "product_added",
  "targetType": "product",
  "targetId": "prod_new123",
  "targetName": "Puma Running Shoes"
}

### Test 2.4: Track User Role Change ✅ FIXED
POST {{baseUrl}}/api/security/admin-action
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "adminId": "000000000000000000000001",
  "adminUsername": "admin@sorasneakers.com",
  "actionType": "user_role_changed",
  "targetType": "user",
  "targetId": "user_456",
  "targetName": "manager@sorasneakers.com"
}

###############################################################################
# TEST 3: SUSPICIOUS ACTIVITY DETECTION (Requires Authentication)
###############################################################################

### Test 3.1: High-Value Purchase from New Account (CRITICAL)
POST {{baseUrl}}/api/security/suspicious-activity
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "type": "high_value_purchase",
  "userId": "user_new_123",
  "username": "newuser@test.com",
  "details": {
    "purchaseAmount": 850,
    "accountAge": 2,
    "accountAgeUnit": "hours",
    "productsPurchased": 5
  }
}

### Test 3.2: Rapid Checkout Detection (HIGH)
POST {{baseUrl}}/api/security/suspicious-activity
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "type": "rapid_checkout",
  "username": "suspicious@example.com",
  "details": {
    "checkoutInterval": 15,
    "intervalUnit": "seconds",
    "transactionCount": 3
  }
}

###############################################################################
# TEST 4: GET SECURITY DASHBOARD DATA
###############################################################################

### Test 4.1: Fetch Complete Security Dashboard
GET {{baseUrl}}/api/security/dashboard
Authorization: Bearer {{token}}

###############################################################################
# QUICK FIXES APPLIED:
# ✅ Line 74: Changed "admin123" → "000000000000000000000001" (valid ObjectId)
# ✅ Line 76: Changed "product_delete" → "product_deleted" (correct enum)
# ✅ Line 87: Changed "admin123" → "000000000000000000000001"
# ✅ Line 89: Changed "product_edit" → "product_edited" (correct enum)
# ✅ Line 104: Changed "admin123" → "000000000000000000000001"
# ✅ Line 106: Changed "product_add" → "product_added" (correct enum)
# ✅ Line 116: Changed "admin123" → "000000000000000000000001"
# ✅ Line 118: Changed "user_promote" → "user_role_changed" (correct enum)
###############################################################################
